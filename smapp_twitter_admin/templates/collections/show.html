{% extends "layout.html" %}
{% block body %}
  <h1>{{ collection_name }}</h1>
  
  <div class="well">
    <ul class="nav nav-tabs" id="myTab">
      <li><a data-target="#latest" data-toggle="tab">Latest hits</a></li>
      <li><a data-target="#graphs" data-toggle="tab">Graphs</a></li>
      <li><a data-target="#filter-criteria" data-toggle="tab">Filter Criteria</a></li>
    </ul>
     
    <div class="tab-content">
      <div class="tab-pane" id="latest">
        <h4>Latest hits</h4>
        <span class="pull-right muted">Total: {{ "{:,}".format(count) }}</span>
        <table class="table table-striped table-condensed">
          <thead>
              <tr>
                  <th>Time</th>
                  <th>User</th>
                  <th>Text</th>
              </tr>
          </thead>
          {% for tweet in latest_tweets %}
              <tr>
                  <td>{{ tweet['timestamp'] }}</td>
                  <td><a href="https://twitter.com/{{ tweet['user']['screen_name'] }}">@{{ tweet['user']['screen_name'] }}</a></td>
                  <td>{{ tweet['text'] }}</td>
              </tr>
          {% endfor %}
        </table>
      </div>


      <div class="tab-pane" id="graphs">
        <div id="tpm-graph">
          <h4>Tweets per minute</h4>
          <button class="btn btn-primary" onclick="show_graph('tpm');">Show</button>
        </div>

        <div id="limits-graph">
          <h4>API rate limits</h4>
          <button class="btn btn-primary" onclick="show_graph('limits');">Show</button>
        </div>
      </div>


      <div class="tab-pane" id="filter-criteria">
        <h3>Filter Criteria</h3>
        <span class="pull-right muted">Count: {{ "{:,}".format(filter_criteria.count()) }}</span>
        <table class="table table-striped table-condensed">
          <thead>
              <tr>
                <th>Filter Type</th>
                <th>Keyword</th>
                <th>Active</th>
                <th>Date Added</th>
                <th>Date Removed</th>
                <th></th>
                <th></th>
              </tr>
          </thead>
          {% for fc in filter_criteria %}
              <tr>
                <td>{{ fc['filter_type'] }}</td>
                <td>{{ fc['value'] }}</td>
                <td>{{ fc['active'] }}</td>
                <td>{{ fc['date_added'] }}</td>
                <td>{{ fc['date_stopped'] }}</td>
                <td>
                  <a href="{{ url_for('filter_criteria_show', collection_name=collection_name, id=fc['_id']) }}"><button class="btn btn-small btn-primary" type="button">Edit</button></a>
                </td>
                <td>
                  <form action="{{ url_for('filter_criteria_delete', collection_name=collection_name, id=fc['_id']) }}" method="POST">
                    <input type="submit" value="Delete" class="btn btn-small btn-danger" />
                  </form>
                </td>
              </tr>
          {% endfor %}
        </table>
      </div>
    </div>
  </div>

  <script>
    window.onload=function(){
      $(function () {
        $('#myTab a:first').tab('show');
      })
    };

    function show_graph(graph_type) {
      var divid = '#' + graph_type + '-graph';
      $(divid + ' > button').hide();
      $(divid).append('<object id="tpm-graph" data="/collections/{{ collection_name }}/graphs/' + graph_type + '" type="image/svg+xml"/>');
    }
  </script>
{% endblock %}